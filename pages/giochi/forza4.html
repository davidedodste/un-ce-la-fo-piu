<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Forza 4</title>
<style>
:root{
  --cols:7;          /* colonne del tabellone                     */
  --rows:6;          /* righe del tabellone                       */
  --cell:80px;       /* lato di una cella                         */
  --gap:6px;
  --blue:#1464d4;
  --red:#e02525;
  --yellow:#f3c517;
  --stack-disk:calc(var(--cell)*.45);   /* diametro pedine in pila */
}
*{box-sizing:border-box;margin:0;padding:0}
body{
  font-family:system-ui,sans-serif;
  display:flex;flex-direction:column;align-items:center;gap:1.4rem;
  margin:40px 0;
}
h1{margin:0}

/*────────── layout: pile laterali + tabellone ──────────*/
#container{display:flex;align-items:center;gap:2rem}

/*────────── pila di pedine rimaste (griglia 3×7) ──────────*/
.stack{
  display:grid;
  grid-template-columns:repeat(3,var(--stack-disk));
  gap:var(--gap);
  align-content:start;
  justify-content:center;
  height:calc(var(--rows)*var(--cell)+(var(--rows)+1)*var(--gap));
  /* nessun colore di sfondo */
}
.stack .disk{
  width:var(--stack-disk);height:var(--stack-disk);
  border-radius:50%;
  box-shadow:inset 0 0 6px rgba(0,0,0,.4);
}
.stack.red    .disk{background:var(--red)}
.stack.yellow .disk{background:var(--yellow)}

/*────────── wrapper con sfondo blu del solo tabellone ──────────*/
#board-wrapper{
  background:var(--blue);
  padding:var(--gap);
  border-radius:1rem;
  transition:box-shadow .2s;        /* per il bordo colorato di turno */
}
#board-wrapper.turn-red   {box-shadow:0 0 0 6px var(--red)}
#board-wrapper.turn-yellow{box-shadow:0 0 0 6px var(--yellow)}

/*────────── tabellone vero e proprio (solo griglia) ──────────*/
#board{
  display:grid;
  grid-template-columns:repeat(var(--cols),var(--cell));
  grid-auto-rows:var(--cell);
  gap:var(--gap);
  position:relative;
}

/* linee visive interne (2 verticali + 2 orizzontali) */
#board::before,#board::after,
#board>:nth-child(3n+2)::before,
#board>:nth-child(-n+3)::after{
  content:"";position:absolute;background:#0002}
#board::before{left:calc(var(--cell)-var(--gap)/2);top:0;width:var(--gap);height:100%}
#board::after {left:calc(2*var(--cell)+var(--gap)/2);top:0;width:var(--gap);height:100%}
#board>:nth-child(3n+2)::before{top:calc(var(--cell)-var(--gap)/2);left:0;width:100%;height:var(--gap)}
#board>:nth-child(-n+3)::after {top:calc(2*var(--cell)+var(--gap)/2);left:0;width:100%;height:var(--gap)}

/* celle vuote e pedine giocate */
.slot{
  width:var(--cell);height:var(--cell);
  border-radius:50%;background:#fff;
  display:flex;align-items:center;justify-content:center;
  cursor:pointer;transition:background .15s;
}
.slot:hover{background:#ddd}
.disk{
  width:90%;height:90%;border-radius:50%;
  box-shadow:inset 0 0 8px rgba(0,0,0,.4)}
.red   {background:var(--red)}
.yellow{background:var(--yellow)}
.win   {animation:blink .4s step-end infinite alternate}
@keyframes blink{to{opacity:.35}}

#msg{font-size:1.2rem;min-height:1.5em}
#restart{
  padding:.6rem 1.3rem;font-size:1rem;
  border:1px solid #333;background:#f6f6f6;border-radius:.5rem;cursor:pointer}
</style>
</head>
<body>

<h1>Forza 4</h1>

<div id="container">
  <div id="stack-red"    class="stack red"></div>

  <div id="board-wrapper">
    <div id="board" aria-label="Griglia di gioco"></div>
  </div>

  <div id="stack-yellow" class="stack yellow"></div>
</div>

<div id="msg"></div>
<button id="restart">Ricomincia</button>

<script>
(() => {
  const COLS=7, ROWS=6, MAX_PEDS=21;

  const boardWrapper = document.getElementById('board-wrapper');
  const boardEl      = document.getElementById('board');
  const redStack     = document.getElementById('stack-red');
  const yelStack     = document.getElementById('stack-yellow');
  const msgEl        = document.getElementById('msg');
  const restartBt    = document.getElementById('restart');

  let board, turn, ended, redLeft, yelLeft;

  /* crea una pedina DOM con la classe indicata */
  const mkDisk = cls => {
    const d=document.createElement('div');
    d.className='disk '+cls; return d;
  };

  /* tabellone vuoto */
  function drawGrid(){
    boardEl.innerHTML='';
    for(let r=0;r<ROWS;r++)
      for(let c=0;c<COLS;c++){
        const div=document.createElement('div');
        div.className='slot'; div.dataset.r=r; div.dataset.c=c;
        boardEl.appendChild(div);
      }
  }

  /* pile laterali */
  function fillStacks(){
    redStack.innerHTML=''; yelStack.innerHTML='';
    for(let i=0;i<redLeft;i++) redStack.appendChild(mkDisk('red'));
    for(let i=0;i<yelLeft;i++) yelStack.appendChild(mkDisk('yellow'));
  }

  const firstFreeRow = col => {
    for(let r=ROWS-1;r>=0;r--) if(!board[r][col]) return r;
    return -1;
  };
  const slot = (r,c) => boardEl.children[r*COLS+c];

  function setTurnUI(){
    boardWrapper.classList.toggle('turn-red',   turn==='R');
    boardWrapper.classList.toggle('turn-yellow',turn==='Y');
    if(!ended){
      msgEl.textContent='Turno: '+(turn==='R'?'Rosso':'Giallo');
      msgEl.style.color = turn==='R' ? 'var(--red)' : 'var(--yellow)';
    }
  }

  function start(){
    board = Array.from({length:ROWS},()=>Array(COLS).fill(''));
    turn  = 'R'; ended = false;
    redLeft = yelLeft = MAX_PEDS;
    drawGrid(); fillStacks();
    msgEl.textContent='Turno: Rosso'; msgEl.style.color='var(--red)';
    boardWrapper.classList.add('turn-red');
    boardWrapper.classList.remove('turn-yellow');
  }

  function decStack(color){
    if(color==='R' && redLeft){ redStack.removeChild(redStack.lastElementChild); redLeft--; }
    if(color==='Y' && yelLeft){ yelStack.removeChild(yelStack.lastElementChild); yelLeft--; }
  }

  function checkWin(r0,c0,col){
    const dirs=[[1,0],[0,1],[1,1],[1,-1]];
    for(const [dr,dc] of dirs){
      let count=1,cells=[[r0,c0]];
      for(let k=1;k<4;k++){
        const r=r0+k*dr,c=c0+k*dc;
        if(r<0||r>=ROWS||c<0||c>=COLS||board[r][c]!==col) break;
        count++;cells.push([r,c]);
      }
      for(let k=1;k<4;k++){
        const r=r0-k*dr,c=c0-k*dc;
        if(r<0||r>=ROWS||c<0||c>=COLS||board[r][c]!==col) break;
        count++;cells.push([r,c]);
      }
      if(count>=4){
        cells.forEach(([r,c])=>slot(r,c).firstChild.classList.add('win'));
        return true;
      }
    }
    return false;
  }

  boardEl.addEventListener('click', e=>{
    const cell=e.target.closest('.slot');
    if(!cell||ended) return;

    const col=+cell.dataset.c;
    const row=firstFreeRow(col);
    if(row===-1) return;            // colonna piena

    board[row][col]=turn;
    slot(row,col).appendChild(mkDisk(turn==='R'?'red':'yellow'));
    decStack(turn);

    if(checkWin(row,col,turn)){
      msgEl.textContent=(turn==='R'?'Rosso':'Giallo')+' ha vinto!';
      ended=true;
    }else if(board.flat().every(Boolean)){
      msgEl.textContent='Pareggio!'; ended=true;
    }else{
      turn=turn==='R'?'Y':'R';
    }
    setTurnUI();
  });

  restartBt.addEventListener('click', start);
  start();
})();
</script>

</body>
</html>
